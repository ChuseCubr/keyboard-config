 /* Copyright 2020 Naoki Katahira
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 2 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */

#include QMK_KEYBOARD_H
#include <stdio.h>

#include "layout.h"

/* For Lily58 users, uncomment this line */
// #include "masks/lily58.h"

/* For Corne users, uncomment this line */
// #include "masks/crkbd.h"

/* For other >34 key users, create a similar file and include here */

enum layer_number {
  _HOME = 0,
  _SYM,
  _FUN,
  _MO3,
  _MO4,
  _MO5
};

// see https://github.com/ChuseCubr/mini-ryoku for layout details
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_HOME] = LAYOUT_mask(_BASE_LAYOUT),
  [_SYM] = LAYOUT_mask(_SYM_LAYOUT),
  [_FUN] = LAYOUT_mask(_FUN_LAYOUT),
  [_MO3] = LAYOUT_mask(_BLANK_LAYOUT),
  [_MO4] = LAYOUT_mask(_BLANK_LAYOUT),
  [_MO5] = LAYOUT_mask(_BLANK_LAYOUT)
};

#ifdef OLED_ENABLE

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
  if (!is_keyboard_master())
    return OLED_ROTATION_180;  // flips the display 180 degrees if offhand
  return rotation;
}

static void render_logo(void) {
  // 'mewo', 128x32px (can't fit in font)
  static const char PROGMEM logo[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x70, 
    0xd0, 0x90, 0xd0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf8, 0xf8, 0x18, 0xf8, 0xf8, 0xf0, 0xe0, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0xf8, 0xfc, 0xfc, 0xfc, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 
    0xc0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xfc, 0xfc, 0xfc, 0xf8, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 
    0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 
    0xe0, 0xc0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x70, 
    0xd0, 0x99, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x8f, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 
    0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 
    0xf3, 0xfb, 0xf1, 0xc0, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0xe0, 0xfc, 0xfe, 0xfe, 0xff, 0xfe, 0xfc, 0x00, 0x00, 0x00, 0x80, 0xfc, 0xfe, 
    0xff, 0xfe, 0xfe, 0xf8, 0x00, 0x00, 0x00, 0x18, 0x3f, 0x7f, 0x7f, 0x7d, 0x7d, 0xfd, 0xf9, 0xf9, 
    0xf9, 0xf1, 0xe1, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xe1, 0xe1, 0xff, 
    0xff, 0xff, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x01, 0x03, 0x0f, 0x1f, 0x3f, 0x3f, 0x3f, 0xbf, 0xff, 0xff, 0x7f, 0x0f, 0x03, 0x00, 0x00, 
    0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x80, 0xc0, 0x80, 0x00, 0x00, 0xfc, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x80, 0xc0, 
    0x80, 0x00, 0x00, 0x01, 0x1f, 0x3f, 0x7f, 0xff, 0xff, 0xff, 0xf8, 0x78, 0x3c, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xe0, 0xf0, 0xf0, 0xe0, 0xc0, 0xc0, 0xc0, 0xe1, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0x3f, 0x00, 0x00, 0x00, 0xf8, 0xfc, 0xff, 0xbf, 0x0f, 0x0f, 0x1f, 0xff, 
    0xff, 0xff, 0xfe, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x1f, 0x1f, 0x1c, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x01, 0x07, 0x0f, 0x0f, 0x1f, 0x1f, 0x1f, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x01, 0x03, 
    0x07, 0x07, 0x03, 0x01, 0x00, 0x00, 0x01, 0x07, 0x0f, 0x0f, 0x1f, 0x1f, 0x1f, 0x0f, 0x07, 0x03, 
    0x01, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x7e, 0xfc, 0xf8, 0xe0, 0xe0, 0xf0, 0xf8, 0xff, 0xff, 0x7f, 
    0x3f, 0x1f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x07, 0x0f, 0x0f, 0x0f, 0x0f, 0x07, 
    0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 
    0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
  };
  oled_write_raw_P(logo, sizeof(logo));
}

static void render_status(void) {
  // details on master half on the unfortunate chance I lose it
  oled_write_P(PSTR("Chase Villarroel\n"), false);
  oled_write_P(PSTR("SN  : 2021-140032\n"), false);
  oled_write_P(PSTR("BLK : BSCS-SS211"), false);
}

bool oled_task_user(void) {
  if (is_keyboard_master()) {
    render_status();
  } else {
    render_logo();
  }
  return false;
}

#endif // OLED_ENABLE

